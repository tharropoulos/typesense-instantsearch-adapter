{"version":3,"file":"Configuration.js","names":["_interopRequireDefault","require","Object","defineProperty","exports","value","Configuration","_slicedToArray2","_classCallCheck2","_createClass2","_this$server$cacheSea","_options$additionalSe","_ref","_this$additionalSearc","_ref2","_this$additionalSearc2","_ref3","_this$additionalSearc3","_ref4","_this$additionalSearc4","_this","_options$geoLocationF","_options$facetableFie","_options$collectionSp","_options$flattenGroup","_options$facetByOptio","_options$filterByOpti","_options$sortByOption","_options$collectionSp2","_options$collectionSp3","_options$collectionSp4","options","arguments","length","undefined","server","nodes","host","port","path","protocol","cacheSearchResultsForSeconds","additionalSearchParameters","query_by","queryBy","preset","sort_by","sortBy","highlight_full_fields","highlightFullFields","entries","forEach","_ref5","_ref6","key","Array","isArray","join","geoLocationField","facetableFieldsWithSpecialCharacters","collectionSpecificSearchParameters","keys","collection","_params$queryBy","_params$preset","_params$sortBy","_ref7","_ref8","_params$highlightFull","params","renderingContent","flattenGroupedHits","facetByOptions","filterByOptions","sortByOptions","collectionSpecificFacetByOptions","collectionSpecificFilterByOptions","collectionSpecificSortByOptions","validate","values","some","c","console","warn","Error"],"sources":["../src/Configuration.js"],"sourcesContent":["\"use strict\";\n\nexport class Configuration {\n  constructor(options = {}) {\n    this.server = options.server || {\n      nodes: [\n        {\n          host: \"localhost\",\n          port: \"8108\",\n          path: \"\",\n          protocol: \"http\",\n        },\n      ],\n    };\n\n    this.server.cacheSearchResultsForSeconds = this.server.cacheSearchResultsForSeconds ?? 2 * 60;\n\n    this.additionalSearchParameters = options.additionalSearchParameters ?? {};\n\n    this.additionalSearchParameters.query_by =\n      this.additionalSearchParameters.queryBy ?? this.additionalSearchParameters.query_by ?? \"\";\n\n    this.additionalSearchParameters.preset =\n      this.additionalSearchParameters.preset ?? this.additionalSearchParameters.preset ?? \"\";\n\n    this.additionalSearchParameters.sort_by =\n      this.additionalSearchParameters.sortBy ?? this.additionalSearchParameters.sort_by ?? \"\";\n\n    this.additionalSearchParameters.highlight_full_fields =\n      this.additionalSearchParameters.highlightFullFields ??\n      this.additionalSearchParameters.highlight_full_fields ??\n      this.additionalSearchParameters.query_by;\n\n    Object.entries(this.additionalSearchParameters).forEach(([key, value]) =>\n      Array.isArray(value) ? (this.additionalSearchParameters[key] = value.join(\",\")) : value,\n    );\n\n    this.geoLocationField = options.geoLocationField ?? \"_geoloc\";\n    this.facetableFieldsWithSpecialCharacters = options.facetableFieldsWithSpecialCharacters ?? [];\n\n    this.collectionSpecificSearchParameters = options.collectionSpecificSearchParameters ?? {};\n\n    Object.keys(this.collectionSpecificSearchParameters).forEach((collection) => {\n      const params = this.collectionSpecificSearchParameters[collection];\n      params.query_by = params.queryBy ?? params.query_by;\n      params.preset = params.preset ?? params.preset;\n      params.sort_by = params.sortBy ?? params.sort_by;\n      params.highlight_full_fields =\n        params.highlightFullFields ??\n        params.highlight_full_fields ??\n        this.additionalSearchParameters.highlight_full_fields ??\n        params.query_by;\n\n      Object.keys(params).forEach((key) => (params[key] === undefined ? delete params[key] : {}));\n    });\n\n    this.renderingContent = options.renderingContent;\n    this.flattenGroupedHits = options.flattenGroupedHits ?? true;\n    this.facetByOptions = options.facetByOptions ?? {};\n    this.filterByOptions = options.filterByOptions ?? {};\n    this.sortByOptions = options.sortByOptions ?? {};\n    this.collectionSpecificFacetByOptions = options.collectionSpecificFacetByOptions ?? {};\n    this.collectionSpecificFilterByOptions = options.collectionSpecificFilterByOptions ?? {};\n    this.collectionSpecificSortByOptions = options.collectionSpecificSortByOptions ?? {};\n  }\n\n  validate() {\n    // Warn if camelCased parameters are used, suggest using snake_cased parameters instead\n    if (\n      this.additionalSearchParameters.queryBy ||\n      Object.values(this.collectionSpecificSearchParameters).some((c) => c.queryBy)\n    ) {\n      console.warn(\n        \"[typesense-instantsearch-adapter] Please use snake_cased versions of parameters in additionalSearchParameters instead of camelCased parameters. For example: Use query_by instead of queryBy. camelCased parameters will be deprecated in a future version.\" +\n          \" We're making this change so that parameter names are identical to the ones sent to Typesense (which are all snake_cased), and to also keep the types for these parameters in sync with the types defined in typesense-js.\",\n      );\n    }\n\n    /*\n     * Either additionalSearchParameters.query_by or additionalSearchParameters.preset needs to be set, or\n     *   All collectionSpecificSearchParameters need to have query_by or preset\n     *\n     * */\n    if (\n      this.additionalSearchParameters.query_by.length === 0 &&\n      this.additionalSearchParameters.preset.length === 0 &&\n      (Object.keys(this.collectionSpecificSearchParameters).length === 0 ||\n        Object.values(this.collectionSpecificSearchParameters).some(\n          (c) => (c.query_by || \"\").length === 0 && (c.preset || \"\").length === 0,\n        ))\n    ) {\n      throw new Error(\n        \"[typesense-instantsearch-adapter] Missing parameter: One of additionalSearchParameters.query_by or additionalSearchParameters.preset needs to be set, or all collectionSpecificSearchParameters need to have either .query_by or .preset set.\",\n      );\n    }\n  }\n}\n"],"mappings":"AAAA,YAAY;;AAAC,IAAAA,sBAAA,GAAAC,OAAA;AAAAC,MAAA,CAAAC,cAAA,CAAAC,OAAA;EAAAC,KAAA;AAAA;AAAAD,OAAA,CAAAE,aAAA;AAAA,IAAAC,eAAA,GAAAP,sBAAA,CAAAC,OAAA;AAAA,IAAAO,gBAAA,GAAAR,sBAAA,CAAAC,OAAA;AAAA,IAAAQ,aAAA,GAAAT,sBAAA,CAAAC,OAAA;AAAA,IAEAK,aAAa,GAAAF,OAAA,CAAAE,aAAA;EACxB,SAAAA,cAAA,EAA0B;IAAA,IAAAI,qBAAA;MAAAC,qBAAA;MAAAC,IAAA;MAAAC,qBAAA;MAAAC,KAAA;MAAAC,sBAAA;MAAAC,KAAA;MAAAC,sBAAA;MAAAC,KAAA;MAAAC,sBAAA;MAAAC,KAAA;MAAAC,qBAAA;MAAAC,qBAAA;MAAAC,qBAAA;MAAAC,qBAAA;MAAAC,qBAAA;MAAAC,qBAAA;MAAAC,qBAAA;MAAAC,sBAAA;MAAAC,sBAAA;MAAAC,sBAAA;IAAA,IAAdC,OAAO,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;IAAA,IAAAxB,gBAAA,mBAAAF,aAAA;IACtB,IAAI,CAAC6B,MAAM,GAAGJ,OAAO,CAACI,MAAM,IAAI;MAC9BC,KAAK,EAAE,CACL;QACEC,IAAI,EAAE,WAAW;QACjBC,IAAI,EAAE,MAAM;QACZC,IAAI,EAAE,EAAE;QACRC,QAAQ,EAAE;MACZ,CAAC;IAEL,CAAC;IAED,IAAI,CAACL,MAAM,CAACM,4BAA4B,IAAA/B,qBAAA,GAAG,IAAI,CAACyB,MAAM,CAACM,4BAA4B,cAAA/B,qBAAA,cAAAA,qBAAA,GAAI,CAAC,GAAG,EAAE;IAE7F,IAAI,CAACgC,0BAA0B,IAAA/B,qBAAA,GAAGoB,OAAO,CAACW,0BAA0B,cAAA/B,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CAAC;IAE1E,IAAI,CAAC+B,0BAA0B,CAACC,QAAQ,IAAA/B,IAAA,IAAAC,qBAAA,GACtC,IAAI,CAAC6B,0BAA0B,CAACE,OAAO,cAAA/B,qBAAA,cAAAA,qBAAA,GAAI,IAAI,CAAC6B,0BAA0B,CAACC,QAAQ,cAAA/B,IAAA,cAAAA,IAAA,GAAI,EAAE;IAE3F,IAAI,CAAC8B,0BAA0B,CAACG,MAAM,IAAA/B,KAAA,IAAAC,sBAAA,GACpC,IAAI,CAAC2B,0BAA0B,CAACG,MAAM,cAAA9B,sBAAA,cAAAA,sBAAA,GAAI,IAAI,CAAC2B,0BAA0B,CAACG,MAAM,cAAA/B,KAAA,cAAAA,KAAA,GAAI,EAAE;IAExF,IAAI,CAAC4B,0BAA0B,CAACI,OAAO,IAAA9B,KAAA,IAAAC,sBAAA,GACrC,IAAI,CAACyB,0BAA0B,CAACK,MAAM,cAAA9B,sBAAA,cAAAA,sBAAA,GAAI,IAAI,CAACyB,0BAA0B,CAACI,OAAO,cAAA9B,KAAA,cAAAA,KAAA,GAAI,EAAE;IAEzF,IAAI,CAAC0B,0BAA0B,CAACM,qBAAqB,IAAA9B,KAAA,IAAAC,sBAAA,GACnD,IAAI,CAACuB,0BAA0B,CAACO,mBAAmB,cAAA9B,sBAAA,cAAAA,sBAAA,GACnD,IAAI,CAACuB,0BAA0B,CAACM,qBAAqB,cAAA9B,KAAA,cAAAA,KAAA,GACrD,IAAI,CAACwB,0BAA0B,CAACC,QAAQ;IAE1CzC,MAAM,CAACgD,OAAO,CAAC,IAAI,CAACR,0BAA0B,CAAC,CAACS,OAAO,CAAC,UAAAC,KAAA;MAAA,IAAAC,KAAA,OAAA9C,eAAA,aAAA6C,KAAA;QAAEE,GAAG,GAAAD,KAAA;QAAEhD,KAAK,GAAAgD,KAAA;MAAA,OAClEE,KAAK,CAACC,OAAO,CAACnD,KAAK,CAAC,GAAIe,KAAI,CAACsB,0BAA0B,CAACY,GAAG,CAAC,GAAGjD,KAAK,CAACoD,IAAI,CAAC,GAAG,CAAC,GAAIpD,KAAK;IAAA,CACzF,CAAC;IAED,IAAI,CAACqD,gBAAgB,IAAArC,qBAAA,GAAGU,OAAO,CAAC2B,gBAAgB,cAAArC,qBAAA,cAAAA,qBAAA,GAAI,SAAS;IAC7D,IAAI,CAACsC,oCAAoC,IAAArC,qBAAA,GAAGS,OAAO,CAAC4B,oCAAoC,cAAArC,qBAAA,cAAAA,qBAAA,GAAI,EAAE;IAE9F,IAAI,CAACsC,kCAAkC,IAAArC,qBAAA,GAAGQ,OAAO,CAAC6B,kCAAkC,cAAArC,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CAAC;IAE1FrB,MAAM,CAAC2D,IAAI,CAAC,IAAI,CAACD,kCAAkC,CAAC,CAACT,OAAO,CAAC,UAACW,UAAU,EAAK;MAAA,IAAAC,eAAA,EAAAC,cAAA,EAAAC,cAAA,EAAAC,KAAA,EAAAC,KAAA,EAAAC,qBAAA;MAC3E,IAAMC,MAAM,GAAGjD,KAAI,CAACwC,kCAAkC,CAACE,UAAU,CAAC;MAClEO,MAAM,CAAC1B,QAAQ,IAAAoB,eAAA,GAAGM,MAAM,CAACzB,OAAO,cAAAmB,eAAA,cAAAA,eAAA,GAAIM,MAAM,CAAC1B,QAAQ;MACnD0B,MAAM,CAACxB,MAAM,IAAAmB,cAAA,GAAGK,MAAM,CAACxB,MAAM,cAAAmB,cAAA,cAAAA,cAAA,GAAIK,MAAM,CAACxB,MAAM;MAC9CwB,MAAM,CAACvB,OAAO,IAAAmB,cAAA,GAAGI,MAAM,CAACtB,MAAM,cAAAkB,cAAA,cAAAA,cAAA,GAAII,MAAM,CAACvB,OAAO;MAChDuB,MAAM,CAACrB,qBAAqB,IAAAkB,KAAA,IAAAC,KAAA,IAAAC,qBAAA,GAC1BC,MAAM,CAACpB,mBAAmB,cAAAmB,qBAAA,cAAAA,qBAAA,GAC1BC,MAAM,CAACrB,qBAAqB,cAAAmB,KAAA,cAAAA,KAAA,GAC5B/C,KAAI,CAACsB,0BAA0B,CAACM,qBAAqB,cAAAkB,KAAA,cAAAA,KAAA,GACrDG,MAAM,CAAC1B,QAAQ;MAEjBzC,MAAM,CAAC2D,IAAI,CAACQ,MAAM,CAAC,CAAClB,OAAO,CAAC,UAACG,GAAG;QAAA,OAAMe,MAAM,CAACf,GAAG,CAAC,KAAKpB,SAAS,GAAG,OAAOmC,MAAM,CAACf,GAAG,CAAC,GAAG,CAAC,CAAC;MAAA,CAAC,CAAC;IAC7F,CAAC,CAAC;IAEF,IAAI,CAACgB,gBAAgB,GAAGvC,OAAO,CAACuC,gBAAgB;IAChD,IAAI,CAACC,kBAAkB,IAAA/C,qBAAA,GAAGO,OAAO,CAACwC,kBAAkB,cAAA/C,qBAAA,cAAAA,qBAAA,GAAI,IAAI;IAC5D,IAAI,CAACgD,cAAc,IAAA/C,qBAAA,GAAGM,OAAO,CAACyC,cAAc,cAAA/C,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CAAC;IAClD,IAAI,CAACgD,eAAe,IAAA/C,qBAAA,GAAGK,OAAO,CAAC0C,eAAe,cAAA/C,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CAAC;IACpD,IAAI,CAACgD,aAAa,IAAA/C,qBAAA,GAAGI,OAAO,CAAC2C,aAAa,cAAA/C,qBAAA,cAAAA,qBAAA,GAAI,CAAC,CAAC;IAChD,IAAI,CAACgD,gCAAgC,IAAA/C,sBAAA,GAAGG,OAAO,CAAC4C,gCAAgC,cAAA/C,sBAAA,cAAAA,sBAAA,GAAI,CAAC,CAAC;IACtF,IAAI,CAACgD,iCAAiC,IAAA/C,sBAAA,GAAGE,OAAO,CAAC6C,iCAAiC,cAAA/C,sBAAA,cAAAA,sBAAA,GAAI,CAAC,CAAC;IACxF,IAAI,CAACgD,+BAA+B,IAAA/C,sBAAA,GAAGC,OAAO,CAAC8C,+BAA+B,cAAA/C,sBAAA,cAAAA,sBAAA,GAAI,CAAC,CAAC;EACtF;EAAC,WAAArB,aAAA,aAAAH,aAAA;IAAAgD,GAAA;IAAAjD,KAAA,EAED,SAAAyE,SAAA,EAAW;MACT;MACA,IACE,IAAI,CAACpC,0BAA0B,CAACE,OAAO,IACvC1C,MAAM,CAAC6E,MAAM,CAAC,IAAI,CAACnB,kCAAkC,CAAC,CAACoB,IAAI,CAAC,UAACC,CAAC;QAAA,OAAKA,CAAC,CAACrC,OAAO;MAAA,EAAC,EAC7E;QACAsC,OAAO,CAACC,IAAI,CACV,6PAA6P,GAC3P,4NACJ,CAAC;MACH;;MAEA;AACJ;AACA;AACA;AACA;MACI,IACE,IAAI,CAACzC,0BAA0B,CAACC,QAAQ,CAACV,MAAM,KAAK,CAAC,IACrD,IAAI,CAACS,0BAA0B,CAACG,MAAM,CAACZ,MAAM,KAAK,CAAC,KAClD/B,MAAM,CAAC2D,IAAI,CAAC,IAAI,CAACD,kCAAkC,CAAC,CAAC3B,MAAM,KAAK,CAAC,IAChE/B,MAAM,CAAC6E,MAAM,CAAC,IAAI,CAACnB,kCAAkC,CAAC,CAACoB,IAAI,CACzD,UAACC,CAAC;QAAA,OAAK,CAACA,CAAC,CAACtC,QAAQ,IAAI,EAAE,EAAEV,MAAM,KAAK,CAAC,IAAI,CAACgD,CAAC,CAACpC,MAAM,IAAI,EAAE,EAAEZ,MAAM,KAAK,CAAC;MAAA,CACzE,CAAC,CAAC,EACJ;QACA,MAAM,IAAImD,KAAK,CACb,+OACF,CAAC;MACH;IACF;EAAC;AAAA","ignoreList":[]}